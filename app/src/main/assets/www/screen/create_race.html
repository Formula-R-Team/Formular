<ons-page id="create-race">
  <ons-toolbar>
    <div class="left"><ons-back-button>Back</ons-back-button></div>
  </ons-toolbar>
  <div id="display-container" style="width: 100%; height: 100%; overflow: hidden; position: fixed; left: 0; top: 0;"><canvas id="display" style="width: 100%; height: 100%;"></canvas></div>
  <script type="text/javascript">
    var exec = cordova.require('cordova/exec');
    ons.getScriptPage().onInit = function() {
      requirejs([ 'paper' ], function(paper) {
        paper.settings.handleSize = 6;
        var canvas = this.querySelector('#display');
        paper.setup(canvas);
        var w = paper.view.viewSize.width, h = paper.view.viewSize.height;
        var col = 'rgba(16, 120, 245, 0.5)';
        var rCirc = new paper.Path.Circle({center: [w / 2, h / 2], radius: 20, strokeWidth: 2, strokeColor: col});
        var rH = new paper.Path.Line({from: [w / 2 - 20, h / 2], to: [w / 2 + 20, h / 2], strokeWidth: 1, strokeColor: col});
        var rV = new paper.Path.Line({from: [w / 2, h / 2 - 20], to: [w / 2, h / 2 + 20], strokeWidth: 1, strokeColor: col});
        paper.view.draw();
        var previousPath = undefined;
        exec(
          function(result) {
            if (previousPath) {
              previousPath.remove();
            }
            if (result.closed) {
              var p = new paper.Point(result.segments[0][0] * w, result.segments[0][1] * h);
              rCirc.position = p;
              rH.position = p;
              rV.position = p;
              var path = new paper.Path({
                segments: result.segments,
                strokeColor: 'rgba(0, 0, 1, 0.5)',
                closed: result.closed,
                selected: true,
                fullySelected: true
              });
              path.scale(w, h, new paper.Point(0, 0));
              //path.simplify(12);
              paper.view.draw();
              previousPath = path;
            }
          }.bind(this),
          function(error) {
            ons.notification.alert(error);
          }.bind(this),
          'Formular',
          'camera/start_capture',
          []
        );
      }.bind(this));
    };
  </script>
</ons-page>
